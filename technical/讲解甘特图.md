将甘特图中的单独的条状称为 元素条，每个元素条代表一个任务：![image-20220801151809436](../AppData/Roaming/Typora/typora-user-images/image-20220801151809436.png)

项目中的甘特图：

![image-20220801150958289](C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220801150958289.png)

确定"天"视角的最小单位宽为40px；周视角280px，对应最小单位时间戳为86400000和 86400000 * 7





主要思路：

确定一个时间段，如2022/01/01-2023/12/31。

将这之间的日期 按照 [{year:2022-01,days:['01','02']}]。。这样的方式渲染出来可以得到需要的日期展示格式，然后将甘特图的每一个元素条定位在相应位置即可

1、首先绘制日期部分的视图。

因为每周时间固定，所以我才用每周= 7*1天的宽度，每月的天数因为不是固定的，并且为了后期方便定位元素条，我将“月”视角看成是放大版本的“天”视角，即用“天”视角的甘特图将总长度按一定比例缩小，并且去掉每天之间的间隔边框，保留日期为“01”的左边框。这样甘特图的日期部分就绘制完毕了。

2、接下来是在日期部分上绘制元素条。

我采取的思路是计算元素条实际或计划开始时间与时间段的开始时间戳之间的差额，在换算成距离，

只有计划或者实际时间的元素条：

天视角距离日期div左边框的距离：marginLeft =（(元素条实际或计划开始时间-时间段的开始时间戳) / 该视角最小单位宽 ）*40

天视角元素条的宽度：width=（(元素条实际或计划开始时间-元素条实际或计划结束时间) / 该视角最小单位宽 ）*40

既有计划与实际的元素条：

计划时间的marginLeft 与width同上

实际时间，给计划时间的元素条给position:relative;给自己position:absolute;再计算实际时间元素条与计划开始时间戳之间的差额，在换算成距离，思路同上。

至此甘特图的元素条及日期部分就绘制完毕了。

应用部分：

需要渲染的任务列表：taskLists:[]

由于树任务列表和甘特图需要联动，如果不会单个任务所在的顺序做处理，那么按照taskLists直接渲染的话，会存在树和甘特图中任务的顺序对不上、添加删除或者移动等会改变任务顺序的操作出bug。并且左右的数据并不互通

因此我一开始使用的对单个任务的增删改进行相应的处理，任务量较大，也很复杂，性能也不好，更容易出错，后来使用了深度优先搜索算法（DFS），将树变成lists，既保证了任务的顺序，也保证了数据的唯一性，极大促进了甘特图的推进。

至此甘特图与树可以在数据层面上进行很好的联动。

如何实现点击日期，甘特图滚动到对应的位置

获取点击日期的时间戳，计算当前视角下与日期左边距的时间戳差值，换算成距离。由于从一开始就规定好了”天“、”周“视角的最小单位，因此在点击日期，甘特图自动滚动到对应的日期就很容易实现了。

困难点：树、甘特图数据联动；月视角实现









​				





